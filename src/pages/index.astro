---
import Layout from '../layouts/Layout.astro';
import Sidebar from '../components/Sidebar.astro';
import SiteDisplay from '../components/SiteDisplay';
import SearchBox from '../components/SearchBox.astro';
import HolidayCounter from '../components/HolidayCounter.astro';
import Calendar from '../components/Calendar.astro';
import Footer from '../components/Footer.astro';

import getSiteData from '../data/sites';

const pageTitle = `${import.meta.env.PUBLIC_WEBSITE_NAME} - ä¼˜è´¨ç½‘ç«™ä¸å®ç”¨å·¥å…·å¯¼èˆªå¹³å°`;
const pageDescription = `${import.meta.env.PUBLIC_WEBSITE_NAME}æ˜¯ä¸€ä¸ªé›†æˆäº†å®ç”¨å·¥å…·å’Œä¼˜è´¨ç½‘ç«™çš„å¯¼èˆªå¹³å°ï¼Œæä¾›èŠ‚å‡æ—¥æé†’ã€åœ¨çº¿å·¥å…·å’Œç²¾é€‰ç½‘ç«™å¯¼èˆªç­‰åŠŸèƒ½ï¼Œå¸®åŠ©ç”¨æˆ·å¿«é€Ÿæ‰¾åˆ°æ‰€éœ€çš„åœ¨çº¿èµ„æºã€‚`;
---

<Layout 
  title={pageTitle}
  description={pageDescription}
  keywords="ç½‘ç«™å¯¼èˆª,ä¼˜è´¨ç½‘ç«™,å¼€å‘å·¥å…·,å­¦ä¹ èµ„æº,èŠ‚å‡æ—¥æé†’,nav,tips"
>
  <!-- æ·»åŠ æ±‰å ¡èœå•æŒ‰é’® -->
  <button
    id="sidebar-toggle"
    class="fixed top-4 left-4 z-50 p-2 rounded-lg bg-white shadow-lg md:hidden"
    aria-label="åˆ‡æ¢èœå•"
  >
    <svg
      class="w-6 h-6"
      fill="none"
      stroke="currentColor"
      viewBox="0 0 24 24"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M4 6h16M4 12h16M4 18h16"
      />
    </svg>
  </button>

  <div class="flex h-screen bg-gray-100">
    <!-- ä¿®æ”¹ä¾§è¾¹æ æ ·å¼ -->
    <aside
      id="sidebar"
      class="sidebar fixed inset-y-0 left-0 transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out md:relative z-40 bg-white"
      role="navigation"
      aria-label="ç½‘ç«™å¯¼èˆª"
    >
      <Sidebar activeSites={getSiteData} />
    </aside>
    
    <!-- æ·»åŠ é®ç½©å±‚ -->
    <div
      id="sidebar-overlay"
      class="fixed inset-0 bg-black opacity-0 pointer-events-none transition-opacity duration-300 ease-in-out md:hidden z-30"
    ></div>

    <main class="flex-1 overflow-auto w-full" role="main">
      <!-- Hero Section -->
      <header class="relative overflow-hidden bg-gradient-to-r from-blue-500 to-indigo-600 text-white">
        <!-- èƒŒæ™¯åŠ¨æ€æ•ˆæœ -->
        <div class="absolute inset-0">
          <div class="absolute inset-0 bg-gradient-to-r from-blue-500/30 to-indigo-600/30 backdrop-blur-xl"></div>
          <div class="absolute inset-0 bg-grid-white/[0.05] bg-grid-repeat-[24px]"></div>
        </div>
        
        <div class="container relative mx-auto px-6 py-16">
          <h1 class="animate__animated animate__fadeInDown text-4xl font-bold mb-4">
            å‘ç°ä¼˜è´¨ç½‘ç«™
            <span class="inline-block animate__animated animate__fadeInRight animate__delay-1s">
              ğŸŒŸ
            </span>
          </h1>
          <p class="animate__animated animate__fadeInUp animate__delay-1s text-xl opacity-90 mb-8">
            æ¢ç´¢äº’è”ç½‘ä¸­æœ€å®ç”¨çš„å·¥å…·å’Œèµ„æº
          </p>
          <div class="animate__animated animate__fadeInUp animate__delay-2s">
            <SearchBox />
          </div>
        </div>
      </header>

      <!-- Utility Components Section -->
      <section class="container mx-auto px-6 py-8 fade-in" aria-label="å®ç”¨å·¥å…·">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
          <!-- Holiday Counter Card -->
          <article class="bg-white rounded-lg shadow-sm p-6 hover-glow">
            <h2 class="text-lg font-semibold mb-4 flex items-center">
              <svg class="w-5 h-5 mr-2 text-blue-500 pulse" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
              èŠ‚å‡æ—¥å€’è®¡æ—¶
            </h2>
            <HolidayCounter />
          </article>

          <!-- Calendar Card -->
          <article class="bg-white rounded-lg shadow-sm p-6 hover-glow">
            <h2 class="text-lg font-semibold mb-4 flex items-center">
              <svg class="w-5 h-5 mr-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
              ä»Šæ—¥æ—¥å†
            </h2>
            <Calendar />
          </article>

       
        </div>

        <!-- Sites Display -->
        <section aria-label="ç½‘ç«™å±•ç¤º" class="fade-in">
          <SiteDisplay client:load />
        </section>
      </section>

      <!-- Footer -->
      <Footer />
    </main>
  </div>

 
</Layout>

<script>
  // ä¾§è¾¹æ æ§åˆ¶é€»è¾‘
  const sidebarToggle = document.getElementById('sidebar-toggle');
  const sidebar = document.getElementById('sidebar');
  const sidebarOverlay = document.getElementById('sidebar-overlay');
  let isSidebarOpen = false;

  function toggleSidebar() {
    isSidebarOpen = !isSidebarOpen;
    
    if (isSidebarOpen) {
      sidebar?.classList.remove('-translate-x-full');
      sidebarOverlay?.classList.remove('opacity-0', 'pointer-events-none');
      sidebarOverlay?.classList.add('opacity-50', 'pointer-events-auto');
      document.body.style.overflow = 'hidden';
    } else {
      sidebar?.classList.add('-translate-x-full');
      sidebarOverlay?.classList.add('opacity-0', 'pointer-events-none');
      sidebarOverlay?.classList.remove('opacity-50', 'pointer-events-auto');
      document.body.style.overflow = '';
    }
  }

  // æ·»åŠ äº‹ä»¶ç›‘å¬
  sidebarToggle?.addEventListener('click', toggleSidebar);
  sidebarOverlay?.addEventListener('click', toggleSidebar);

  // å¤„ç† ESC é”®å…³é—­ä¾§è¾¹æ 
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && isSidebarOpen) {
      toggleSidebar();
    }
  });

  // å¤„ç†çª—å£å¤§å°å˜åŒ–
  window.addEventListener('resize', () => {
    if (window.innerWidth >= 768 && isSidebarOpen) {
      toggleSidebar();
    }
  });
</script>

<style>
  .container {
    max-width: 1400px;
  }

  .tool-button {
    @apply flex flex-col items-center justify-center p-2 rounded-lg bg-gray-50 hover:bg-gray-100 transition-all duration-200;
  }

  .tool-icon-wrapper {
    @apply p-2 rounded-full bg-white shadow-sm text-blue-500 mb-1 group-hover:text-blue-600 group-hover:shadow transition-all duration-200;
  }

  .tool-label {
    @apply text-xs text-gray-600 group-hover:text-gray-900;
  }

  /* æ·»åŠ æ‰“å°æ ·å¼ */
  @media print {
    .sidebar {
      display: none;
    }
    
    .tool-button {
      break-inside: avoid;
    }
  }

  .sidebar {
    width: 280px; /* è®¾ç½®å›ºå®šå®½åº¦ */
    max-width: 80vw; /* ç§»åŠ¨ç«¯æœ€å¤§å®½åº¦ */
  }

  /* æ·»åŠ æ»šåŠ¨æ¡æ ·å¼ */
  .sidebar {
    scrollbar-width: thin;
    scrollbar-color: rgba(156, 163, 175, 0.5) transparent;
  }

  .sidebar::-webkit-scrollbar {
    width: 6px;
  }

  .sidebar::-webkit-scrollbar-track {
    background: transparent;
  }

  .sidebar::-webkit-scrollbar-thumb {
    background-color: rgba(156, 163, 175, 0.5);
    border-radius: 3px;
  }

  @media (max-width: 768px) {
    .sidebar {
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
    }
  }
</style>

